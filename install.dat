DROP TABLE IF EXISTS `actions`;

CREATE TABLE `actions` (
  `id` int NOT NULL,
  `time` int NOT NULL DEFAULT '0',
  `timer` int NOT NULL DEFAULT '0',
  `card_number` varchar(15) NOT NULL DEFAULT '',
  `pool_id` int NOT NULL DEFAULT '0',
  `device` int NOT NULL DEFAULT '0',
  `action` varchar(255) NOT NULL DEFAULT '',
  `data` text NOT NULL,
  `count` int NOT NULL DEFAULT '0',
  `progress` int NOT NULL DEFAULT '0',
  `status` enum('inprogress','waiting','suspension','suspended','') NOT NULL DEFAULT 'waiting',
  `success` int NOT NULL DEFAULT '0',
  `errors` int NOT NULL DEFAULT '0',
  `uniq` varchar(8) NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

DROP TABLE IF EXISTS `answer`;

CREATE TABLE `answer` (
  `step` int NOT NULL,
  `answer` text NOT NULL,
  `device` int NOT NULL DEFAULT '0',
  `time` int NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

DROP TABLE IF EXISTS `card2action`;

CREATE TABLE `card2action` (
  `id` int NOT NULL,
  `device` int NOT NULL DEFAULT '0',
  `action` int NOT NULL DEFAULT '0',
  `row` int NOT NULL DEFAULT '0',
  `place` varchar(63) NOT NULL DEFAULT ''
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

DROP TABLE IF EXISTS `card2pool`;

CREATE TABLE `card2pool` (
  `id` int NOT NULL,
  `pool` int NOT NULL DEFAULT '0',
  `card` varchar(15) NOT NULL DEFAULT '',
  `done` tinyint(1) NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

DROP TABLE IF EXISTS `cards`;

CREATE TABLE `cards` (
  `id` int NOT NULL,
  `number` varchar(15) NOT NULL DEFAULT '',
  `title` varchar(32) NOT NULL DEFAULT '',
  `operator` varchar(16) NOT NULL DEFAULT '0',
  `roaming` tinyint(1) NOT NULL DEFAULT '0',
  `device` int NOT NULL DEFAULT '0',
  `folder` varchar(32) NOT NULL DEFAULT '',
  `balance` double NOT NULL DEFAULT '0',
  `place` varchar(6) NOT NULL DEFAULT '',
  `time` int NOT NULL DEFAULT '0',
  `status` enum('free','inprogress','waiting') NOT NULL DEFAULT 'free',
  `time_number` int NOT NULL DEFAULT '0',
  `time_balance` int NOT NULL DEFAULT '0',
  `time_sms` int NOT NULL DEFAULT '0',
  `comment` varchar(255) NOT NULL DEFAULT ''
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT;

DROP TABLE IF EXISTS `cards2folder`;

CREATE TABLE `cards2folder` (
  `id` int NOT NULL,
  `number` varchar(15) NOT NULL DEFAULT '',
  `title` varchar(32) NOT NULL DEFAULT '',
  `operator` varchar(16) NOT NULL DEFAULT '0',
  `balance` double NOT NULL DEFAULT '0',
  `place` varchar(6) NOT NULL DEFAULT '',
  `time` int NOT NULL DEFAULT '0',
  `time_number` int NOT NULL DEFAULT '0',
  `time_balance` int NOT NULL DEFAULT '0',
  `time_sms` int NOT NULL DEFAULT '0',
  `comment` text NOT NULL,
  `folder_id` int NOT NULL DEFAULT '0',
  `done` tinyint NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT;

DROP TABLE IF EXISTS `devices`;

CREATE TABLE `devices` (
  `id` int NOT NULL,
  `title` varchar(60) NOT NULL DEFAULT '',
  `model` enum('','SR-Train','SR-Nano-500','SR-Nano-1000','SR-Box-8','SR-Box-Bank','SR-Organizer') NOT NULL DEFAULT '',
  `token_local` varchar(5) NOT NULL DEFAULT '',
  `token_remote` varchar(10) NOT NULL DEFAULT '',
  `modems` varchar(64) NOT NULL DEFAULT '',
  `ip` varchar(21) NOT NULL DEFAULT '',
  `type` enum('client','server') NOT NULL DEFAULT 'client',
  `time` int NOT NULL DEFAULT '0',
  `step` int NOT NULL DEFAULT '100',
  `data` text NOT NULL,
  `status` enum('free','inprogress','waiting') NOT NULL DEFAULT 'free',
  `serial` varchar(18) NOT NULL DEFAULT '',
  `serial_time` int NOT NULL DEFAULT '0',
  `pause` int NOT NULL DEFAULT '0',
  `folder` varchar(255) NOT NULL DEFAULT 'a:3:{s:5:"title";s:7:"Default";s:4:"time";s:1:"0";s:7:"comment";s:23:"По умолчанию";}',
  `press` int NOT NULL DEFAULT '0',
  `errors` int NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

DROP TABLE IF EXISTS `flags`;

CREATE TABLE `flags` (
  `id` int NOT NULL,
  `time` int NOT NULL DEFAULT '0',
  `name` varchar(15) NOT NULL DEFAULT '',
  `device` int NOT NULL DEFAULT '0',
  `value` varchar(32) NOT NULL DEFAULT '',
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT;

DROP TABLE IF EXISTS `folders`;

CREATE TABLE `folders` (
  `id` int NOT NULL,
  `time` int NOT NULL DEFAULT '0',
  `title` varchar(32) NOT NULL DEFAULT '',
  `comment` varchar(200) NOT NULL DEFAULT ''
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

DROP TABLE IF EXISTS `link_incoming`;

CREATE TABLE `link_incoming` (
  `id` int NOT NULL,
  `time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `device` int NOT NULL DEFAULT '0',
  `step` int NOT NULL DEFAULT '0',
  `answer` text NOT NULL,
  `uniq` varchar(8) NOT NULL DEFAULT ''
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

DROP TABLE IF EXISTS `link_outgoing`;

CREATE TABLE `link_outgoing` (
  `id` int NOT NULL,
  `time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `device` int NOT NULL DEFAULT '0',
  `step` int NOT NULL DEFAULT '0',
  `command` text NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

DROP TABLE IF EXISTS `modems`;

CREATE TABLE `modems` (
  `id` int NOT NULL,
  `time` int NOT NULL DEFAULT '0',
  `device` int NOT NULL DEFAULT '0',
  `modems` text NOT NULL,
  `row` int NOT NULL DEFAULT '0',
  `numbers` varchar(255) NOT NULL DEFAULT '',
  `pool_id` int NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

DROP TABLE IF EXISTS `operators`;

CREATE TABLE `operators` (
  `id` int NOT NULL,
  `title` varchar(60) NOT NULL DEFAULT '',
  `title_r` varchar(60) NOT NULL DEFAULT '',
  `name` varchar(32) NOT NULL DEFAULT '',
  `color` varchar(6) NOT NULL DEFAULT '',
  `color_r` varchar(6) NOT NULL DEFAULT '',
  `prefix` varchar(6) NOT NULL DEFAULT '',
  `prefix_r` varchar(6) NOT NULL DEFAULT '',
  `get_number` varchar(32) NOT NULL DEFAULT '',
  `get_number_type` enum('ussd','sms','none') NOT NULL DEFAULT 'none',
  `get_balance` varchar(32) NOT NULL DEFAULT '',
  `get_balance_type` enum('ussd','sms','none','') NOT NULL DEFAULT 'none',
  `get_number_r` varchar(32) NOT NULL DEFAULT '',
  `get_number_type_r` enum('ussd','sms','none') NOT NULL DEFAULT 'none',
  `get_balance_r` varchar(32) NOT NULL DEFAULT '',
  `get_balance_type_r` enum('ussd','sms','none','') NOT NULL DEFAULT 'none',
  `time` int NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Сотовые операторы';

INSERT INTO `operators` (`id`, `title`, `title_r`, `name`, `color`, `color_r`, `prefix`, `prefix_r`, `get_number`, `get_number_type`, `get_balance`, `get_balance_type`, `get_number_r`, `get_number_type_r`, `get_balance_r`, `get_balance_type_r`, `time`) VALUES
(1, 'Билайн', '', 'BEE', 'FFBB00', '', '7', '', '*110*10#', 'sms', '#102#', 'ussd', '', 'none', '', 'none', 1588081415),
(2, 'МТС', '', 'MTS', 'FF0000', '', '7', '', '*111*0887#', 'sms', '#100#', 'ussd', '', 'none', '', 'none', 1588081415),
(3, 'Мегафон', '', 'MEGAFON', '00AA66', '', '7', '', '*205#', 'ussd', '*100#', 'ussd', '', 'none', '', 'none', 1588081415),
(4, 'Теле2', '', 'TELE2', '000000', '', '7', '', '*201#', 'ussd', '*105#', 'ussd', '', 'none', '', 'none', 1588081415),
(5, 'Yota', '', 'YOTA', '0088FF', '', '7', '', '*103#', 'ussd', '*100#', 'ussd', '', 'none', '', 'none', 1588081415),
(6, 'Ростелеком', '', 'ROSTELECOM', 'b863fd', '000000', '7', '', '*110#', 'sms', '*122#', 'sms', '', 'none', '', 'none', 1588081415);

DROP TABLE IF EXISTS `pools`;

CREATE TABLE `pools` (
  `id` int NOT NULL,
  `title` varchar(32) NOT NULL DEFAULT '',
  `time` int NOT NULL DEFAULT '0',
  `status` enum('free','inprogress','waiting','') NOT NULL DEFAULT 'free',
  `marker` int NOT NULL DEFAULT '0',
  `key` varchar(32) NOT NULL DEFAULT ''
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

DROP TABLE IF EXISTS `reports`;

CREATE TABLE `reports` (
  `id` int NOT NULL,
  `time_begin` int NOT NULL DEFAULT '0',
  `time_end` int NOT NULL DEFAULT '0',
  `place` text NOT NULL,
  `card_number` varchar(15) NOT NULL,
  `pool_id` int NOT NULL DEFAULT '0',
  `device` int NOT NULL DEFAULT '0',
  `action` varchar(255) NOT NULL DEFAULT '',
  `count` int NOT NULL DEFAULT '0',
  `success` int NOT NULL DEFAULT '0',
  `errors` int NOT NULL DEFAULT '0',
  `user_id` int NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT;

DROP TABLE IF EXISTS `staff`;

CREATE TABLE `staff` (
  `id` int NOT NULL,
  `time` int NOT NULL DEFAULT '0',
  `name` varchar(32) NOT NULL DEFAULT '',
  `login` varchar(32) NOT NULL DEFAULT '',
  `pass` varchar(32) NOT NULL DEFAULT '',
  `pool` int NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT;

DROP TABLE IF EXISTS `users`;

CREATE TABLE `users` (
  `id` int(9) NOT NULL,
  `login` varchar(32) NOT NULL DEFAULT '',
  `pass` varchar(32) NOT NULL DEFAULT '',
  `email` varchar(64) NOT NULL DEFAULT ''
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Пользователи';

INSERT INTO `users` (`id`, `login`, `pass`, `email`) VALUES
(1, 'admin', 'admin', '');

DROP TABLE IF EXISTS `values`;

CREATE TABLE `values` (
  `id` int NOT NULL,
  `name` varchar(32) NOT NULL DEFAULT '',
  `value` text NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

INSERT INTO `values` (`id`, `name`, `value`) VALUES
(1, 'main_menu', 'Настройки - setup.php\r\nАгрегаторы - setup_devices.php;submenu\r\nОператоры связи - setup_operators.php;submenu\r\nSIM-карты - cards.php\r\nПулы - pools.php;submenu\r\nДиски - folders.php;submenu\r\nOnline - online.php;submenu\r\nSMS - sms.php\r\nЗадачи - actions.php\r\nОтчеты - reports.php;submenu\r\nСотрудники - staff.php\r\nTerminal - terminal.php'),
(2, 'page_limit', '1000'),
(3, 'code_block', '1'),
(4, 'term_int', '1000'),
(5, 'email', ''),
(6, 'log_size', '1000');

ALTER TABLE `actions`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `number` (`id`),
  ADD KEY `operator` (`id`),
  ADD KEY `time` (`id`);

ALTER TABLE `answer`
  ADD PRIMARY KEY (`step`),
  ADD KEY `time` (`time`);

ALTER TABLE `card2action`
  ADD PRIMARY KEY (`id`),
  ADD KEY `action` (`action`) USING BTREE,
  ADD KEY `modems` (`row`) USING BTREE;

ALTER TABLE `card2pool`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `card2pool` (`pool`,`card`) USING BTREE,
  ADD KEY `card` (`card`),
  ADD KEY `pool` (`pool`),
  ADD KEY `done` (`done`);

ALTER TABLE `cards`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `combo` (`place`,`number`),
  ADD KEY `time` (`number`),
  ADD KEY `time_number` (`time_number`),
  ADD KEY `time_balance` (`time_balance`),
  ADD KEY `time_sms` (`time_sms`),
  ADD KEY `place` (`place`) USING BTREE,
  ADD KEY `status` (`status`),
  ADD KEY `title` (`title`),
  ADD KEY `number` (`number`),
  ADD KEY `operator` (`operator`);

ALTER TABLE `cards2folder`
  ADD PRIMARY KEY (`id`),
  ADD KEY `folder_id` (`folder_id`),
  ADD KEY `done` (`done`);

ALTER TABLE `devices`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `token_remote` (`token_remote`),
  ADD KEY `ip` (`id`),
  ADD KEY `time` (`id`),
  ADD KEY `pause` (`pause`),
  ADD KEY `serial` (`serial`),
  ADD KEY `serial_time` (`serial_time`);

ALTER TABLE `flags`
  ADD UNIQUE KEY `namedev` (`name`,`device`),
  ADD KEY `id` (`id`),
  ADD KEY `name` (`name`),
  ADD KEY `device` (`device`);

ALTER TABLE `folders`
  ADD PRIMARY KEY (`id`),
  ADD KEY `title` (`title`);

ALTER TABLE `link_incoming`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `uniq` (`device`,`step`,`uniq`) USING BTREE,
  ADD KEY `device` (`device`),
  ADD KEY `step` (`step`);

ALTER TABLE `link_outgoing`
  ADD PRIMARY KEY (`id`),
  ADD KEY `device` (`device`),
  ADD KEY `step` (`step`);

ALTER TABLE `modems`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `device` (`device`) USING BTREE,
  ADD KEY `time` (`id`),
  ADD KEY `pool_id` (`pool_id`);

ALTER TABLE `operators`
  ADD PRIMARY KEY (`id`),
  ADD KEY `name` (`name`) USING BTREE;

ALTER TABLE `pools`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `title` (`title`),
  ADD KEY `status` (`status`),
  ADD KEY `key` (`key`);

ALTER TABLE `reports`
  ADD PRIMARY KEY (`id`),
  ADD KEY `time` (`time_begin`),
  ADD KEY `user_id` (`user_id`);

ALTER TABLE `staff`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `login` (`login`),
  ADD KEY `name` (`name`) USING BTREE,
  ADD KEY `time` (`time`),
  ADD KEY `pool` (`pool`);

ALTER TABLE `values`
  ADD UNIQUE KEY `id` (`id`),
  ADD KEY `name` (`name`);

ALTER TABLE `actions`
  MODIFY `id` int NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=1;

ALTER TABLE `answer`
  MODIFY `step` int NOT NULL AUTO_INCREMENT;

ALTER TABLE `card2action`
  MODIFY `id` int NOT NULL AUTO_INCREMENT;

ALTER TABLE `card2pool`
  MODIFY `id` int NOT NULL AUTO_INCREMENT;

ALTER TABLE `cards`
  MODIFY `id` int NOT NULL AUTO_INCREMENT;

ALTER TABLE `cards2folder`
  MODIFY `id` int NOT NULL AUTO_INCREMENT;

ALTER TABLE `devices`
  MODIFY `id` int NOT NULL AUTO_INCREMENT;

ALTER TABLE `flags`
  MODIFY `id` int NOT NULL AUTO_INCREMENT;

ALTER TABLE `folders`
  MODIFY `id` int NOT NULL AUTO_INCREMENT;

ALTER TABLE `link_incoming`
  MODIFY `id` int NOT NULL AUTO_INCREMENT;

ALTER TABLE `link_outgoing`
  MODIFY `id` int NOT NULL AUTO_INCREMENT;

ALTER TABLE `modems`
  MODIFY `id` int NOT NULL AUTO_INCREMENT;

ALTER TABLE `operators`
  MODIFY `id` int NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=7;

ALTER TABLE `pools`
  MODIFY `id` int NOT NULL AUTO_INCREMENT;

ALTER TABLE `reports`
  MODIFY `id` int NOT NULL AUTO_INCREMENT;

ALTER TABLE `staff`
  MODIFY `id` int NOT NULL AUTO_INCREMENT;

ALTER TABLE `values`
  MODIFY `id` int NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=7;

COMMIT;
